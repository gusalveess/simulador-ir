# Simulador de Imposto de Renda

Este projeto simula o preenchimento de declara√ß√µes de imposto de renda com backend em **NestJS** e frontend em **ReactJS**. O backend utiliza **PostgreSQL** para armazenar os dados e **Jest** para testes unit√°rios.

---

## üìå Tecnologias

- **Backend**: NestJS, TypeScript, TypeORM, PostgreSQL
- **Frontend**: NextJS, TypeScript, TailwindCSS
- **Banco de Dados**: PostgreSQL
- **Testes**: Jest
- **Containeriza√ß√£o**: Docker

---

## ‚öôÔ∏è Configura√ß√£o das Vari√°veis de Ambiente

Crie um arquivo `.env` para definir as vari√°veis de ambiente do backend e do frontend.

### üîπ Backend

**Caso esteja utilizando Docker**, crie o arquivo `.env` dentro da pasta `backend` com:

```ini
POSTGRES_HOST=simulador-ir-db-1
POSTGRES_PORT=5432
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
DATABASE_NAME=simulador_ir
JWT_SECRET={SUA_CHAVE_SECRETA}
PORT=8000
```
### üîπ Frontend
O arquivo .env deve ser criado na pasta frontend e √© o mesmo para qualquer ambiente:

```ini
VITE_API_URL=http://localhost:8000
VITE_PORT=5173
```
## üöÄ Como Executar o Projeto
### üîπ Com Docker

Este √© o m√©todo mais simples para rodar o projeto sem precisar instalar depend√™ncias manualmente.

1. Clone o reposit√≥rio:

bash
git clone https://github.com/gusalveess/simulador-ir.git
cd simulador-ir
```
2. Inicie os containers do backend e banco de dados PostgreSQL:

bash
sudo docker-compose up --build
```
3. Acesse a aplica√ß√£o:

bash
Backend: http://localhost:8000
Frontend: http://localhost:5173
```
### üîπ Sem Docker (Rodando Localmente)
1. Instale as depend√™ncias do backend e frontend:

```bash
cd backend
npm install

cd ../frontend
npm install
```
2. Configure o banco de dados PostgreSQL localmente criando a base de dados:

```sql
CREATE DATABASE simulador_ir;
```
3. Cria√ß√£o das tabelas (necess√°rio apenas se rodando sem Docker):

```sql
CREATE TABLE IF NOT EXISTS public.usuarios
(
    id SERIAL PRIMARY KEY,
    nome VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL,
    "senhaHash" TEXT NOT NULL,
    "criadoEm" TIMESTAMP DEFAULT now(),
    "twoFactorSecret" VARCHAR,
    "is2FAEnabled" BOOLEAN DEFAULT false
);
```

```sql
CREATE TABLE IF NOT EXISTS public.declaracoes
(
    id SERIAL PRIMARY KEY,
    ano INTEGER NOT NULL,
    dados JSONB NOT NULL,
    status VARCHAR(50) DEFAULT 'N√£o Submetida',
    "criadoEm" TIMESTAMP DEFAULT now(),
    "usuarioId" INTEGER REFERENCES public.usuarios(id) ON DELETE CASCADE
);
```
4. Inicie o backend:

```bash
cd backend
npm run start:dev
```
5. Inicie o frontend:

```bash
cd frontend
npm run dev
```

5. Acesse a aplica√ß√£o:

```bash
Backend: http://localhost:8000
Frontend: http://localhost:5173
```

## üß™ Testes Unit√°rios com Jest
O backend utiliza Jest para testes unit√°rios. Para rodar os testes:

### Com Docker:

```bash
docker-compose exec backend npm run test
```
### Sem Docker (localmente):

```bash
cd backend
npm run test
```

## üìú Documenta√ß√£o da API
A API possui documenta√ß√£o no Swagger, acess√≠vel em:

```bash
http://localhost:8000/docs
```

## üöÄ CI/CD Pipeline
O projeto utiliza GitHub Actions para Integra√ß√£o Cont√≠nua (CI) e Entrega Cont√≠nua (CD).

### üîπ Backend
A pipeline √© acionada automaticamente nos seguintes eventos:

- Push para o branch main
- Pull Request para o branch main

O processo √© dividido em duas etapas principais:

1. **Testes**: Em seguida, o c√≥digo √© testado automaticamente. Os testes s√£o executados para garantir que as funcionalidades estejam funcionando corretamente, e um relat√≥rio de cobertura de testes √© gerado.
   
2. **Build**: Por fim, o processo de build √© realizado, preparando o c√≥digo para a produ√ß√£o e verificando se o processo de compila√ß√£o √© bem-sucedido.
### üîπ Frontend
A pipeline para o frontend segue uma abordagem similar, sendo acionada automaticamente nos seguintes eventos:

- Push para o branch main
- Pull Request para o branch main

As etapas incluem:

1. **Instala√ß√£o de Depend√™ncias**: O GitHub Actions instala todas as depend√™ncias necess√°rias para o projeto frontend.
   
2. **Build**: O c√≥digo √© compilado usando o Vite para gerar a vers√£o de produ√ß√£o da aplica√ß√£o.

## üéØ Agora seu projeto est√° organizado e pronto para rodar de forma eficiente!
